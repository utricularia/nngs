-------------------------------------------------------------------
-- NNGS SERVER README
-------------------------------------------------------------------

The files contained in this tarball comprise the No Name Go Server
(NNGS) source code.

For licencing information, see the file COPYING.


>> COMPILATION AND INSTALLATION

Before compiling, read and edit src/nngsconfig.h and src/nngsmain.h
Things like mail program locations are specified therein.
You may also want to check config.h after running ./configure

Configuration-method has changed!
Most of the configuration items are kept in a single nngs.cnf -file.
If not found, nngs *creates* this file, whith the current default-
values in it (which have been established by the ./configure ).
Edit and enjoy...

NNGS needs mlrate. Unfortunately, the original (pem's) mlrate
is not autoconfd/automaked. If you can't get your hands on an
AC/AM's copy, you will need to move all of it's
source, into a src/ subdirectory, and you may need some
minor changes.

Configure and compile mlrate and then NNGS.  Here's how:
(current version numbers may be different...)

tar xvzf mlrate-1.0.xx.tar.gz
cd mlrate-1.0.xx
./configure
make
cd ..

_READ_ the README file in the mlrate directory.  It contains much useful
information on how to set up the ratings system to work properly.

tar xvzf nngs-1.1.yy.tar.gz
cd nngs-1.1.yy
ln -s ../mlrate-1.0.xx mlrate
./configure --prefix=/whatever/dir/you/want
make install

The 'make install' command installs the server and all basic
help files necessary for its functionality.
All files needed by the server are installed under the --prefix.
Once running, the server will put all of it's data (players,games,logfile)
under this prefix, too. This may grow ...

To run and test it:
$prefix/bin/nngssrv
telnet localhost 9696

>> DATA FILES

Data and logfiles will be in $prefix/share/nngssrv/*

Several files need to be installed manually to avoid damage
when you update an existing server.

In $prefix/share/nngssrv/ladder you will find two example ladder
files.  Copy them (or remame them) to remove the '.example'

In $prefix/share/nngssrv/messages you will find default message
files for login, logout, etc.  Rename them to remove the 'default.'
part to activate them.

>> SETTING UP ALTERNATE LOCATIONS.

The config file mechanism enables you to change file locations
without recompiling. You can also use separate locations for data
and the nngssrv binary. (but I would advise you *not* to make too
wild choices ;-)

The easiest way to set things up is:
1) do a configure&compile&and install of nngs
2) start the binary, and kill it.
3) edit the nngs.cnf, which will have been written in the current directory.
   The config file contains enough comment to be self-explanatory.

If you want nngs to run in a chroot()ed environment ('jail'), you'll
have to do some manual tuning.
1) the chroot() systemcall itself requires root privileges.
   the program starts as root, then chdir()s, chroot()s, fork()s twice
   , and changes gid and uid.
   Currently, it does not close filedescriptors, change process group,
   or detach from its CTTY. Just the two forks should do.
2) Mail cannot be sent by /usr/bin/mail et.al. (unless a copy exists in the
   jail, which will also need the loader, and part of the /lib/*so, and maybe
   more)
   setting the maile to SMTP, a built-in mailer is used.
   this will only need gethostbyname(), which relies on /etc/hosts and/or
   /etc/resolv.conf. *these need to be present in jail, or mail won't work*
3) For safety: if anything fails (chroot, setuid, ...) the program will
   refuse to work and exits.
4) Maybe (?depending on platform?) other files (/dev/zero) are needed.
5) As an aid in debugging, a file "written.cnf" is written in the
   chroot() -jail. The pathnames in this file will be relative to the
   chroot() directory. (prefix is snipped)
5) YMMV



>> USERS AND ADMINS

When you install NNGS for the first time, you'll need to manually
create a user with 'admin' - rights. This can be ANY valid name.
Once there is an admin-account, it can be used to grant admin-rights
to other users.
NOTE: the admin-status is stored in TWO places: the userfile proper,
and a lists/admin - file. You'l need both.
There already is a user 'admin' in the lists/admins.default -file
, you'll need to
1) create a user named 'admin' by logging in and using
   the 'register' -command, and lgging out.
2) manually edit the user file for 'admin' in .../players/a/admin:
   change the line:
VARS: 1:4:0:1:0:1:1:0 :0:1:1:0:1:1:0:0 :0:0:0:0:0:0:0:0 :0:4:1:3:90:19:10:25 :33:0:0:33
   to:
VARS: 1:4:0:1:0:1:1:0 :0:1:1:0:1:1:0:0 :0:100:0:0:0:0:0:0 :0:4:1:3:90:19:10:25 :33:0:0:33
   (this field is the adminLevel)---------^^^
3) on the next logon, the 'admin' account will have unlimited rights.

>> DEVELOPMENT

The server code is undergoing development and contributions are
welcome.  See:

<http://www.sourceforge.org/nngs>

<http://people.debian.org/~lohner/nngs> #Obsolete!!

for the latest status and sources.
Contributions and suggestions are welcome.

When sending patches that span several files, please use
diff -ruN <orig-dir> <modified-dir>


>> MAJOR CHANGES

Major changes since the beginning of this project:
- autoconf and automake so it compiles easily on many platforms, even windoze
- clean source tree
... all help files, admin files etc. included
... a 'make install' will install a working server
... all data dirs organized into one place ($prefix/share/nngssrv)
... all game and player dirs created on install
- nngs local malloc() and salloc() removed
- mlrate cleaned up
- most format strings taken out of the code
- internationalization
... chinese (messages and help files) (courtesy of LGS)
... german (messages only)
... others to follow
- added some caching, to reduce reading/writing of playerdb to/from disk.
- changed clock resolution for games to 0.1 sec.
- moved configuration into .cnf file.
- added chroot() support.
- experimental UDP port, to be used by a PHP/web interface.

>> WINDOWS

The server now works on windows as well!  Here's how:
- Get and install cygwin (>=1.1.8) from http://www.cygwin.com
- follow the instructions above to compile and install as on unix

